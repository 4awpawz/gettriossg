<!DOCTYPE html>
<html lang="en">

<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-67538650-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'UA-67538650-3');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="description" content="Fast, simple yet powerful JavaScript-driven static site generation.">
    <meta name="author" content="Jeffrey Schwartz">
    <meta name="generator" content="Trio v4.3.1">
    <title>Tag-Based Callbacks - Trio</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Lora|Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="/css/libs/highlight/bf6c14925e66edb1526b6c9489b3c042-github.css">
    <link rel="stylesheet" href="/css/9cd8c59bb7edc0bc7383db556c5dadb8-main.css">
    <script src="/scripts/e497281e462342b50ccbb59b462856dd-highlight.pack.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>
</head>

<body>
    <header class="header header--fixed header--green">
        <section class="container header__container">
            <input class="hamburger-checkbox header__hamburger-checkbox" type="checkbox" id="hamburger-checkbox" autocomplete="off">
            <label class="hamburger-helper header__hamburger-container" for="hamburger-checkbox">
                <div class="hamburger">
                    <div class="hamburger__bun">
                        <div class="hamburger__patty"></div>
                        <div class="hamburger__patty"></div>
                        <div class="hamburger__patty"></div>
                    </div>
                </div>
            </label>
            <div class="header__promo">
                <img class="header__promo-image" src="/media/b66d421676dcc7ac68959fd41c82c140-brand.svg" alt="Trio Icon">
                <div class="header__promo-text">T<span class="header__promo-text-smallcaps">rio</span>
                    <span class="header__promo-text-version">v4.3.1</span>

                </div>
            </div>
            <nav class="header__nav">
                <ul class="header__nav-items">
                    <li class="header__nav-item">
                        <a class="header__nav-item-link" href="/">Home</a>
                    </li>
                    <li class="header__nav-item header__nav-item--active">
                        <a class="header__nav-item-link" href="/docs/v4/">Docs</a>
                    </li>
                    <li class="header__nav-item">
                        <a class="header__nav-item-link" href="/blog">Blog</a>
                    </li>
                </ul>
            </nav>
        </section>
    </header>
    <main class="container doc-page">
        <aside class="doc-page-index">
            <h2 class="doc-page-index__header">T<span class="doc-page-index__header-smallcaps">rio</span> <span class="doc-page-index__header-version">v4.3.1</span></h2>
            <aside class="doc-page-index__list-container">
                <ul class="doc-page-index__list">
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/upgrading">Upgrading</a>
                        <div class="line"></div>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4">About</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/gettingstarted">Getting Started</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/coreconcepts">Core Concepts</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/projectstructure">Project Structure</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/pagegeneration">Page Generation</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/linkingconventions">Linking Conventions</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/frontmatter">Front Matter</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/tagattributes">Tag Attributes</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/template">Template</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/fragment">Fragment</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/include">Include</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/jsondata">JSON Data</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/metadata">Metadata</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link doc-page-index__list-item-link--current" href="/docs/v4/tagbasedcallbacks">Tag-Based Callbacks</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/scsssasscss">SCSS/SASS/CSS</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/blogging">Blogging</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/collections">Collections</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/permalinks">Permalinks</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/commandline">Command Line</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/incrementalbuild">Incremental Build</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/configuration">Configuration</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/additionalresources">Additional Resources</a>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="/docs/v4/faq">FAQ</a>
                        <div class="line"></div>
                    </li>
                    <li class="doc-page-index__list-item">
                        <a class="doc-page-index__list-item-link" href="https://github.com/4awpawz/trio">Github Repo &amp; Issue Tracker</a>
                    </li>
                </ul>

            </aside>
        </aside>
        <article class="doc-page-content">
            <section class="notification">Documentation is evolving and is a WIP</section>
            <section class="doc-page-content__copy">
                <h1>Tag-Based Callbacks</h1>

                <p>Trio scans your composites for HTML tags that are decorated with the <a href="/docs/v4/tagattributes#data-trio-callback">data-trio-callback</a> attribute and <em>asynchronously</em> calls the JavaScript Node modules they name, passing them a single object whose properties can be used along with <a target="_blank" href="https://cheerio.js.org/">cheerio</a>&apos;s selector API to augment the composites with dynamic content.</p>

                <ul>
                    <li><em>file location</em>: root/source/callbacks</li>
                    <li><em>file type/content</em>: .js/JavaScript Node Module</li>
                </ul>

                <blockquote class="note-tip">
                    <p>Trio treats your project&apos;s markup as plain text, meaning there is no DOM involved and parses it using the <em>jQuery-like</em> selector API provided by the awesome <a target="_blank" href="https://cheerio.js.org/">cheerio</a> OS library. jQuery&apos;s selector API documentation can be found at <a target="_blank" href="https://jquery.com/">jquery.com</a>.</p>
                </blockquote>

                <h2>Declaring Tag-Based Callbacks In Your Markup</h2>

                <p>To declare tag-based callbacks in your markup you decorate the tags you want to target in <em>template</em>, <em>fragment</em> and <em>include</em> assets with <em>data-trio-callback</em> attributes, and assign them the names of the callbacks located in the <em>root/source/callbacks</em> folder:</p>

                <figure>
                    <pre><code class="html">&lt;ul data-trio-callback=&quot;blogtaglist&quot;&gt;&lt;/ul&gt;</code></pre>
                    <figcaption>Example: Declaring A Tag-Based Callback</figcaption>
                </figure>

                <p>The callbacks can then reference the decorated tags to augment them with dynamic content using the <em>$tag</em> property. See <a href="#implementing-tag-based-callbacks">Implementing Tag Based Callbacks</a> below for more information.</p>

                <h2 id="implementing-tag-based-callbacks">Implementing Tag-Based Callbacks</h2>

                <p>Each module must export a single function which, when called by Trio, is passed a single argument</p>
                <pre><code class="javascript">{ $tag, $page, asset, site, cheerio }</code></pre>

                <p>which can be <em>destructured</em></p>
                <pre><code class="javascript">({ $tag, $page, asset, site, cheerio })</code></pre>
                <p> to access its properties. See <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Unpacking_fields_from_objects_passed_as_function_parameter">Unpacking fields from objects passed as function parameter </a> for more information.</p>

                <p>Callbacks can be implemented to run <em>synchronously</em></p>

                <figure>
                    <pre><code class="js">module.exports = ({ $tag, site }) =&gt; {
    site.tagsCatalog.forEach(item =&gt; {
        $tag.append(`
            &lt;li class=&quot;tag__list-item&quot;&gt;
                &lt;a data-trio-link class=&quot;tag__list-item-link&quot;
                href=&quot;/blog/tag/${item.tag.toLowerCase()}&quot;&gt;${item.tag}&lt;/a&gt;
            &lt;/li&gt;
        `);
    });
};</code></pre>
                    <figcaption>Example: Synchronous JavaScript Callback</figcaption>
                </figure>

                <p>or <em>asynchronously</em>, using async/await.</p>

                <figure>
                    <pre><code class="js">module.exports = async ({ $tag, site }) =&gt; {
    const catalog = await getCatalogFromCloud(...);
    catalog.forEach(item =&gt; {
        $tag.append(`
            &lt;li class=&quot;catalog-item__list-item&quot;&gt;
                &lt;a data-trio-link class=&quot;catalog-item__list-item-link&quot;
                href=&quot;/catalog/item/${item.name}&quot;&gt;${item.price.toFixed(2)}&lt;/a&gt;
            &lt;/li&gt;
        `)
    });
};</code></pre>
                    <figcaption>Example: Asynchronous JavaScript Callback</figcaption>
                </figure>

                <h2>Argument Properties</h2>

                <h3>$page</h3>
                <blockquote class="note-important">
                    <p>Please note that this property was originally named <em>$</em> but was renamed to <em>$page</em> in v1.0.0-rc.5.</p>
                </blockquote>
                <p>$page is a <em>cheerio function</em>. It is equivalent to jQuery&apos;s <em>$</em> and <em>jQuery()</em> functions and can be used to return a collection of matched tags in the composite when you are targeting tags other than $tag.</p>
                <figure>
                    <pre><code class="js">module.exports = ({ $page, site }) =&gt; {
    site.tagsCatalog.forEach(item =&gt; {
        $page(&quot;ul.tag__list&quot;).append(`
            &lt;li class=&quot;tag__list-item&quot;&gt;
                &lt;a data-trio-link class=&quot;tag__list-item-link&quot;
                href=&quot;/blog/tag/${item.tag.toLowerCase()}&quot;&gt;${item.tag}&lt;/a&gt;
            &lt;/li&gt;
        `);
    });
    $page(&quot;div.page-modified-date&quot;).append(new Date().toDateString());
};</code></pre>
                    <figcaption>Example: Targeting A Composite&apos;s Content Using $page</figcaption>
                </figure>

                <h3>$tag</h3>
                <p>$tag is a <em>cheerio wrapper</em> for the tag which was decorated with the <em>data-trio-callback</em> attribute. It can be used to target the tag with dynamic content.</p>
                <figure>
                    <pre><code class="js">module.exports = ({ $tag }) =&gt; {
    $tag.append(new Date().toDateString());
};</code></pre>
                    <figcaption>Example: Targeting A Tag&apos;s Content Using $tag</figcaption>
                </figure>

                <h3 id="site">site</h3>
                <p>site exposes the organized collection of <a href="/docs/v4/metadata#site">metadata</a> that Trio creates from your project&apos;s assets. Its catalogs - <a href="/docs/v4/metadata#frags">frags</a>, <a href="/docs/v4/metadata#articles-catalog">articlesCatalog</a>, <a href="/docs/v4/metadata#categories-catalog">categoriesCatalog</a>, <a href="/docs/v4/metadata#tags-catalog">tagsCatalog</a>, <a href="/docs/v4/metadata#data-catalog">dataCatalog</a> - as well as its other properties can be used to augment your composites with dynamic content.</p>
                <figure>
                    <pre><code class="js">module.exports = ({ $tag, site }) =&gt; {
    site.tagsCatalog.forEach(item =&gt; {
        $tag.append(`
            &lt;li class=&quot;tag__list-item&quot;&gt;
                &lt;a data-trio-link class=&quot;tag__list-item-link&quot;
                href=&quot;/blog/tag/${item.tag.toLowerCase()}&quot;&gt;${item.tag}&lt;/a&gt;
            &lt;/li&gt;
        `);
    });
};</code></pre>
                    <figcaption>Example: Targeting A Tag&apos;s Content With Data From site.tagsCatalog</figcaption>
                </figure>

                <h3 id="asset">asset</h3>
                <p>asset exposes the <a href="/docs/v4/metadata#asset">metadata specific to the fragment</a>, including its <em>front matter</em>. Its catalogs - <a href="/docs/v4/metadata#related-articles-by-category">relatedArticlesByCategory</a>, <a href="/docs/v4/metadata#related-articles-by-tag">relatedArticlesByTag</a>, <a href="/docs/v4/metadata#related-articles-by-tag-flattened">relatedArticlesByTagFlattened</a> - as well as its other properties can be used to augment your composites with dynamic content.</p>
                <figure>
                    <pre><code class="js">module.exports = ({ $tag, asset }) =&gt; {
    const data = asset.matter.data;
    $tag.find(&quot;h1.article__title&quot;).append(data.title);
    $tag.find(&quot;span.article__category&quot;).append(`&quot;${data.category}&quot;`);
    $tag.find(&quot;span.article__date&quot;).append(asset.articleDate);
    $tag.find(&quot;img.article__img&quot;).attr(&quot;src&quot;, `/media/${data.image}`);
};</code></pre>
                    <figcaption>Example: Targeting A Tag&apos;s Content With Data From asset</figcaption>
                </figure>

                <h3 id="asset">cheerio</h3>
                <p>cheerio exposes a constructor function that can be used to <a target="_blank" href="https://cheerio.js.org/#loading">load and manipulate dynamic tag structures</a>, such as:</p>
                <figure>
                    <pre><code class="js">const $ = cheerio.load(&apos;&lt;h2 class=&quot;title&quot;&gt;Hello world&lt;/h2&gt;&apos;);

$(&apos;h2.title&apos;).text(&apos;Hello there!&apos;);
$(&apos;h2&apos;).addClass(&apos;welcome&apos;);

$.html();
//=&gt; &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h2 class=&quot;title welcome&quot;&gt;Hello there!&lt;/h2&gt;&lt;/body&gt;&lt;/html&gt;
};</code></pre>
                    <figcaption>Example: Using The Cheerio Constructor Function To Load And Manipulate Dynamic Tag Structures</figcaption>
                </figure>

                <blockquote class="note-important">Since both <em>$page</em> and <em>$tag</em> also provide methods for creating and manipulating dynamic tag structures the <em>cheerio</em> property is therefore basically redundant. It is currently being maintained for legacy sake but you are advised that <em>the cheerio property is a strong candidate for deprecation</em> in a future release of Trio.</blockquote>

                <h2>Internal Module Dependencies And Caching</h2>

                <p>Tag-Based-callbacks can, of course, have their own internal module dependencies. When they do, though, you should import them using <a target="_blank" href="https://www.npmjs.com/package/import-fresh"><em>import-fresh</em></a> (or some similar package) to guarantee that you are always importing uncached copies of them.</p>

                <figure>
                    <pre><code class="JavaScript"><mark>const importFresh = require(&apos;import-fresh&apos;);</mark>
<mark>const capitalize = importFresh(&quot;../lib/capitalize&quot;);</mark>

module.exports = ({ $tag, site }) =&gt; {
    site.articlesCount &amp;&amp; site.articlesCatalog.forEach(item =&gt; {
        const data = item.matter.data;
        $tag.append(`
                &lt;li&gt;
                    &lt;a data-trio-link href=&quot;${item.url}&quot;&gt;
                        ${data.title} - Posted to ${<mark>capitalize</mark>(data.category[0])} - ${item.articleDate}
                    &lt;/a&gt;
                &lt;/li&gt;
            `);
    });
};</code></pre>
                    <figcaption>Example: Tag-Based Callback Importing Uncached Module Dependency</figcaption>
                </figure>

                <p>In the above example, if you had used <em>require</em> instead of <em>import-fresh</em>, and you were running any of Trio&apos;s build commands with the <em>watch option</em>, then any changes you make to the module <em>./lib/capitalize</em> would be ignored because Node will import the module from its cache.</p>

                <blockquote class="note-tip">
                    <p>Trio uses <em>import-fresh</em> internally to import uncached tag-based callbacks.</p>
                </blockquote>

                <h2 id="declaringinternaldependencies">Declaring Your Tag-Based Callback Module&apos;s Internal Dependencies To Trigger Incremental Builds</h2>

                <p>When building incrementally, Trio will detect that you have made modifications to your tag-based callbacks, and it will trigger a build to regenerate only those composites whose assets relate by way of their chains of dependencies to the modified callback. However, Trio will not automatically trigger a build when:</p>

                <ul>
                    <li>You have made modifications to modules that your tag-based callbacks might require (internal module dependencies), such as to a library that you created in root/source/callbacks/lib.</li>
                    <li>You have made modifications to JSON files in the root/source/data folder that your tag-based callbacks might require</li>
                </ul>

                <p>To remedy these 2 situations, you can optionally add front matter to your tag-based callbacks with the properties discussed below that will inform Trio to trigger a build whenever these internal dependencies are modified.</p>

                <h3>Declaring Your Tag-Based Callback Module&apos;s Internal Module Dependencies</h3>
                <p>You can declare a single module dependency using the <mark>moduleDependencies</mark> property</p>
                <figure>
                    <pre><code class="js">/*
moduleDependencies: ../lib/getDate
*/</code></pre>
                    <figcaption>Example: Declaring A Single Module Dependency</figcaption>
                </figure>

                <p>and you can declare multiple module dependencies.</p>

                <figure>
                    <pre><code class="js">/*
moduleDependencies:
- ../lib/getDate
- ../lib/getTime
*/</code></pre>
                    <figcaption>Example: Declaring Multiple Module Dependencies</figcaption>
                </figure>

                <h3>Declaring Your Tag-Based Callback Module&apos;s Internal JSON Data File Dependencies</h3>
                <p>You can declare a single JSON file dependency using the <mark>dataDependencies</mark> property.</p>
                <figure>
                    <pre><code class="js">/*
dataDependencies: contactInfo
*/</code></pre>
                    <figcaption>Example: Declaring A Single JSON File Dependencies</figcaption>
                </figure>

                <p>and you can declare multiple JSON file dependencies.</p>

                <figure>
                    <pre><code class="js">/*
dataDependencies:
- contactInfo
- portfolio
*/</code></pre>
                    <figcaption>Example: Declaring Multiple JSON File Dependencies</figcaption>
                </figure>

                <h2 id="declaringexternaldependencies">Declaring External Dependencies On Metadata To Trigger Incremental Builds</h2>

                <p>When building incrementally, Trio will detect that you have made modifications to your fragment, include, template and tag-based callback assets, and it will trigger a build to regenerate only those composites whose assets relate by way of their chains of dependencies to those modified assets. However, Trio will not regenerate composites whose own assets haven&apos;t changed but which consume the metadata generated from unrelated modified assets, such as for pages that contain lists of other pages (e.g. blog index pages, tag pages, category pages, catalog pages, portfolio pages, etc.).</p>

                <p>To remedy this situation, you can add the <em>alwaysBuild</em> property to your fragment&apos;s front matter which will cause Trio to always mark this fragment as stale.</p>

                <blockquote class="note-tip">
                    <p>Using <a href="/docs/v4/collections">collections</a>, which were introduced in v2.0.0, can eliminate having to use <em>alwaysBuild</em>.</p>
                </blockquote>
                <figure>
                    <pre><code class="html">&lt;!--
template: blogpage
title: Trio Blog | Official blog for Trio static site generator.
<mark>alwaysBuild: true</mark>
--&gt;</code></pre>
                    <figcaption>Example: Using The Front Matter alwaysBuild Property</figcaption>
                </figure>
                <h2>See Also</h2>

                <ul>
                    <li><a target="_blank" href="https://www.npmjs.com/package/cheerio">cheerio</a></li>
                    <li><a href="/docs/v4/fragment">Fragment</a></li>
                    <li><a href="/docs/v4/frontmatter">Front Matter</a></li>
                    <li><a href="/docs/v4/incrementalbuild">Incremental Build</a></li>
                    <li><a href="/docs/v4/coreconcepts">Core Concepts</a></li>
                    <li><a href="/docs/v4/metadata">Metadata</a></li>
                    <li><a href="/docs/v4/tagattributes">Tag Attributes</a></li>
                </ul>
            </section>
            <footer class="docfooter footer--hide-the-love">
                <p class="show-the-love">&quot;Built with <span class="heart">&#x2665;</span> for the Web, and a passion for simplifying complex things.&quot;</p>

                <p>&#xA9;<span>2018-2021</span> Jeffrey Schwartz All Rights Reserved</p>

                <p>Code licensed <a target="_blank" href="https://github.com/4awpawz/trio/blob/master/LICENSE">MIT</a>, docs <a target="_blank" href="https://creativecommons.org/licenses/by/3.0/">CC By 3.0</a></p>

                <p>Currently <span>v4.3.1</span></p>

                <p><a href="https://github.com/4awpawz/trio#changelog" target="_blank">Changelog</a></p>

            </footer>
        </article>
    </main>
</body>

</html>